<!DOCTYPE html>
<html>
<head>
    <title>Bé”®å¯¼å¼¹è§¦å‘æµ‹è¯•</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #111; color: #0f0; }
        .result { padding: 10px; margin: 5px 0; background: #222; }
        .success { background: #040; }
        .fail { background: #400; }
    </style>
</head>
<body>
    <h1>ğŸš€ Bé”®å¯¼å¼¹å‘å°„è§¦å‘æµ‹è¯•</h1>
    <div id="results"></div>

    <script src="game_config.js"></script>
    <script src="gamepad_manager.js"></script>
    <script>
        // æ¨¡æ‹Ÿç©å®¶å¯¹è±¡
        class MockPlayer {
            constructor() {
                this.isPlayer = true;
                this.strayMissiles = 10;
                this.maxStrayMissiles = 10;
                this.lastMissileLaunch = 1.0;
                this.missileCooldown = 0.5;
                this.playerIndex = 1;
                this.x = 100;
                this.y = 100;
            }
            
            launchStrayMissiles(enemies) {
                if (this.strayMissiles <= 0) return [];
                if (this.lastMissileLaunch < this.missileCooldown) return [];
                
                this.strayMissiles--;
                this.lastMissileLaunch = 0;
                
                log(`ğŸš€ å¯¼å¼¹å‘å°„æˆåŠŸ! å‰©ä½™: ${this.strayMissiles}`, 'success');
                return [{ id: Date.now(), type: 'missile' }];
            }
        }

        let gamepadManager = null;
        let mockPlayer = null;
        let testResults = [];

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('results').appendChild(div);
            console.log(msg);
        }

        function init() {
            log('ğŸ”§ åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...');
            
            try {
                gamepadManager = new GamepadManager();
                mockPlayer = new MockPlayer();
                log('âœ… åˆå§‹åŒ–å®Œæˆ');
                startTest();
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'fail');
            }
        }

        function startTest() {
            log('ğŸ® å¼€å§‹Bé”®å¯¼å¼¹è§¦å‘æµ‹è¯• - è¯·æŒ‰Bé”®...');
            
            let lastLaunchState = false;
            
            setInterval(() => {
                if (!gamepadManager) return;
                
                gamepadManager.update();
                
                // è·å–Player 1è¾“å…¥
                const input = gamepadManager.getPlayerInput(1);
                if (input) {
                    // æ£€æŸ¥å¯¼å¼¹å‘å°„è§¦å‘
                    if (input.launchMissiles && !lastLaunchState) {
                        log('ğŸ¯ Bé”®è§¦å‘æ£€æµ‹åˆ°!', 'success');
                        
                        // æ¨¡æ‹Ÿæ¸¸æˆä¸­çš„å¯¼å¼¹å‘å°„é€»è¾‘
                        const missiles = mockPlayer.launchStrayMissiles([]);
                        if (missiles && missiles.length > 0) {
                            log('âœ… å¯¼å¼¹å‘å°„æˆåŠŸè§¦å‘!', 'success');
                        } else {
                            log('âŒ å¯¼å¼¹å‘å°„å¤±è´¥', 'fail');
                        }
                    }
                    lastLaunchState = input.launchMissiles;
                }
            }, 50);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
