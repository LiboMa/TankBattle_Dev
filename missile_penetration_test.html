<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ å¯¼å¼¹ç©¿å¢™åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Courier New', monospace;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }
        
        .test-section {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #FFD700;
        }
        
        .test-title {
            color: #FF6600;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .test-canvas {
            border: 2px solid #666;
            background: #000;
            display: block;
            margin: 10px auto;
        }
        
        .controls {
            text-align: center;
            margin: 15px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #FF6600, #FF8800);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
        }
        
        .btn:hover {
            background: linear-gradient(45deg, #FF8800, #FFAA00);
            transform: translateY(-2px);
        }
        
        .info {
            background: rgba(0,100,200,0.2);
            border-left: 4px solid #0066CC;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            background: rgba(0,200,0,0.2);
            border-left: 4px solid #00CC00;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning {
            background: rgba(255,165,0,0.2);
            border-left: 4px solid #FFA500;
            padding: 15px;
            margin: 15px 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
        }
        
        .stat-label {
            font-size: 14px;
            color: #CCC;
            margin-top: 5px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ å¯¼å¼¹ç©¿å¢™åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="info">
            <strong>ğŸ¯ ç©¿å¢™åŠŸèƒ½è¯´æ˜ï¼š</strong>
            <ul>
                <li>è·Ÿè¸ªå¯¼å¼¹å¯ä»¥ç©¿é€æ‰€æœ‰éšœç¢ç‰©å’Œå¢™å£</li>
                <li>å¯¼å¼¹åªä¸æ•Œäººå¦å…‹å‘ç”Ÿç¢°æ’</li>
                <li>æ™®é€šå­å¼¹ä»ç„¶ä¼šè¢«éšœç¢ç‰©é˜»æŒ¡</li>
                <li>è¿™ä½¿å¾—å¯¼å¼¹æˆä¸ºæ”»å‡»èº²åœ¨æ©ä½“åæ•Œäººçš„åˆ©å™¨</li>
            </ul>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ¯ ç©¿å¢™è½¨è¿¹æ¼”ç¤º</div>
            <canvas id="penetrationCanvas" class="test-canvas" width="800" height="400"></canvas>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF6600;"></div>
                    <span>è·Ÿè¸ªå¯¼å¼¹ (ç©¿å¢™)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFD700;"></div>
                    <span>æ™®é€šå­å¼¹ (è¢«é˜»æŒ¡)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #666;"></div>
                    <span>éšœç¢ç‰©/å¢™å£</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF4444;"></div>
                    <span>æ•Œäººå¦å…‹</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4444FF;"></div>
                    <span>ç©å®¶å¦å…‹</span>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="startPenetrationDemo()">ğŸš€ å¼€å§‹ç©¿å¢™æ¼”ç¤º</button>
                <button class="btn" onclick="startNormalBulletDemo()">ğŸ’¥ æ™®é€šå­å¼¹å¯¹æ¯”</button>
                <button class="btn" onclick="clearCanvas()">ğŸ”„ æ¸…ç©ºç”»å¸ƒ</button>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ“Š ç¢°æ’æ£€æµ‹å¯¹æ¯”</div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="missileHits">0</div>
                    <div class="stat-label">å¯¼å¼¹å‘½ä¸­æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="bulletBlocked">0</div>
                    <div class="stat-label">å­å¼¹è¢«é˜»æŒ¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="obstaclesPenetrated">0</div>
                    <div class="stat-label">ç©¿é€éšœç¢ç‰©æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="penetrationRate">100%</div>
                    <div class="stat-label">å¯¼å¼¹ç©¿é€ç‡</div>
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="runCollisionTest()">ğŸ§ª è¿è¡Œç¢°æ’æµ‹è¯•</button>
                <button class="btn" onclick="resetStats()">ğŸ“Š é‡ç½®ç»Ÿè®¡</button>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">ğŸ® æ‰‹æŸ„æŒ‰é”®æµ‹è¯•</div>
            <div class="info">
                <strong>æ”¯æŒçš„æŒ‰é”®ç»„åˆï¼š</strong>
                <ul>
                    <li><strong>BæŒ‰é’®</strong>: ä¼ ç»Ÿå¯¼å¼¹å‘å°„é”®</li>
                    <li><strong>RTæ‰³æœº</strong>: æ–°å¢å¯¼å¼¹å‘å°„é”®</li>
                    <li><strong>ç»„åˆæ”¯æŒ</strong>: BæŒ‰é’® || RTæ‰³æœº (ä»»ä¸€æŒ‰ä¸‹å³å¯)</li>
                </ul>
            </div>
            <div id="gamepadStatus" style="text-align: center; margin: 20px 0; font-size: 18px;">
                ğŸ® è¯·è¿æ¥Xboxæ‰‹æŸ„è¿›è¡Œæµ‹è¯•
            </div>
            <div class="controls">
                <button class="btn" onclick="testGamepadInput()">ğŸ® æµ‹è¯•æ‰‹æŸ„è¾“å…¥</button>
                <button class="btn" onclick="simulateButtonPress('B')">ğŸ…±ï¸ æ¨¡æ‹ŸBæŒ‰é’®</button>
                <button class="btn" onclick="simulateButtonPress('RT')">ğŸ¯ æ¨¡æ‹ŸRTæ‰³æœº</button>
            </div>
        </div>
        
        <div class="success">
            <strong>âœ… åŠŸèƒ½éªŒè¯è¦ç‚¹ï¼š</strong>
            <ul>
                <li>ğŸš€ å¯¼å¼¹è½¨è¿¹ç©¿è¿‡éšœç¢ç‰©ï¼Œä¸å‘ç”Ÿç¢°æ’</li>
                <li>ğŸ’¥ æ™®é€šå­å¼¹è¢«éšœç¢ç‰©é˜»æŒ¡ï¼Œæ— æ³•ç©¿é€</li>
                <li>ğŸ¯ å¯¼å¼¹åªä¸æ•Œäººå¦å…‹å‘ç”Ÿç¢°æ’å¹¶é€ æˆä¼¤å®³</li>
                <li>ğŸ® BæŒ‰é’®å’ŒRTæ‰³æœºéƒ½èƒ½è§¦å‘å¯¼å¼¹å‘å°„</li>
                <li>ğŸ“Š ç©¿é€ç‡è¾¾åˆ°100%ï¼Œæ— éšœç¢ç‰©ç¢°æ’</li>
            </ul>
        </div>
    </div>

    <script>
        let animationId = null;
        let stats = {
            missileHits: 0,
            bulletBlocked: 0,
            obstaclesPenetrated: 0
        };

        // æ¸¸æˆå¯¹è±¡
        const gameObjects = {
            player: { x: 100, y: 200, width: 30, height: 20 },
            enemy: { x: 700, y: 200, width: 30, height: 20 },
            obstacles: [
                { x: 300, y: 150, width: 50, height: 100 },
                { x: 500, y: 100, width: 50, height: 200 }
            ],
            missiles: [],
            bullets: []
        };

        // ç©¿å¢™æ¼”ç¤º
        function startPenetrationDemo() {
            clearCanvas();
            const canvas = document.getElementById('penetrationCanvas');
            const ctx = canvas.getContext('2d');
            
            // åˆ›å»ºå¯¼å¼¹
            const missile = {
                x: gameObjects.player.x + 30,
                y: gameObjects.player.y + 10,
                targetX: gameObjects.enemy.x,
                targetY: gameObjects.enemy.y + 10,
                speed: 3,
                type: 'missile'
            };
            
            gameObjects.missiles = [missile];
            animatePenetration(ctx);
        }

        // æ™®é€šå­å¼¹æ¼”ç¤º
        function startNormalBulletDemo() {
            clearCanvas();
            const canvas = document.getElementById('penetrationCanvas');
            const ctx = canvas.getContext('2d');
            
            // åˆ›å»ºå­å¼¹
            const bullet = {
                x: gameObjects.player.x + 30,
                y: gameObjects.player.y + 10,
                targetX: gameObjects.enemy.x,
                targetY: gameObjects.enemy.y + 10,
                speed: 4,
                type: 'bullet'
            };
            
            gameObjects.bullets = [bullet];
            animatePenetration(ctx);
        }

        // åŠ¨ç”»å¾ªç¯
        function animatePenetration(ctx) {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            function animate() {
                ctx.clearRect(0, 0, 800, 400);
                
                // ç»˜åˆ¶åœºæ™¯
                drawScene(ctx);
                
                // æ›´æ–°å’Œç»˜åˆ¶å¯¼å¼¹
                updateProjectiles();
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦ç»§ç»­åŠ¨ç”»
                if (gameObjects.missiles.length > 0 || gameObjects.bullets.length > 0) {
                    animationId = requestAnimationFrame(animate);
                }
            }
            
            animate();
        }

        // ç»˜åˆ¶åœºæ™¯
        function drawScene(ctx) {
            // ç»˜åˆ¶ç©å®¶
            ctx.fillStyle = '#4444FF';
            ctx.fillRect(gameObjects.player.x, gameObjects.player.y, gameObjects.player.width, gameObjects.player.height);
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '12px Arial';
            ctx.fillText('Player', gameObjects.player.x, gameObjects.player.y - 5);
            
            // ç»˜åˆ¶æ•Œäºº
            ctx.fillStyle = '#FF4444';
            ctx.fillRect(gameObjects.enemy.x, gameObjects.enemy.y, gameObjects.enemy.width, gameObjects.enemy.height);
            ctx.fillStyle = '#FFFFFF';
            ctx.fillText('Enemy', gameObjects.enemy.x, gameObjects.enemy.y - 5);
            
            // ç»˜åˆ¶éšœç¢ç‰©
            ctx.fillStyle = '#666666';
            gameObjects.obstacles.forEach(obstacle => {
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });
            
            // ç»˜åˆ¶å¯¼å¼¹
            ctx.fillStyle = '#FF6600';
            gameObjects.missiles.forEach(missile => {
                ctx.beginPath();
                ctx.arc(missile.x, missile.y, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶è½¨è¿¹
                ctx.strokeStyle = '#FF6600';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(missile.x - 20, missile.y);
                ctx.lineTo(missile.x, missile.y);
                ctx.stroke();
            });
            
            // ç»˜åˆ¶å­å¼¹
            ctx.fillStyle = '#FFD700';
            gameObjects.bullets.forEach(bullet => {
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // æ›´æ–°å¼¹è¯
        function updateProjectiles() {
            // æ›´æ–°å¯¼å¼¹ (ç©¿å¢™)
            gameObjects.missiles.forEach((missile, index) => {
                const dx = missile.targetX - missile.x;
                const dy = missile.targetY - missile.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > missile.speed) {
                    missile.x += (dx / distance) * missile.speed;
                    missile.y += (dy / distance) * missile.speed;
                    
                    // æ£€æŸ¥æ˜¯å¦ç©¿è¿‡éšœç¢ç‰©
                    gameObjects.obstacles.forEach(obstacle => {
                        if (missile.x > obstacle.x && missile.x < obstacle.x + obstacle.width &&
                            missile.y > obstacle.y && missile.y < obstacle.y + obstacle.height) {
                            stats.obstaclesPenetrated++;
                            updateStats();
                        }
                    });
                } else {
                    // å‡»ä¸­ç›®æ ‡
                    stats.missileHits++;
                    updateStats();
                    gameObjects.missiles.splice(index, 1);
                }
            });
            
            // æ›´æ–°å­å¼¹ (è¢«é˜»æŒ¡)
            gameObjects.bullets.forEach((bullet, index) => {
                const dx = bullet.targetX - bullet.x;
                const dy = bullet.targetY - bullet.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > bullet.speed) {
                    bullet.x += (dx / distance) * bullet.speed;
                    bullet.y += (dy / distance) * bullet.speed;
                    
                    // æ£€æŸ¥éšœç¢ç‰©ç¢°æ’
                    let blocked = false;
                    gameObjects.obstacles.forEach(obstacle => {
                        if (bullet.x > obstacle.x && bullet.x < obstacle.x + obstacle.width &&
                            bullet.y > obstacle.y && bullet.y < obstacle.y + obstacle.height) {
                            blocked = true;
                        }
                    });
                    
                    if (blocked) {
                        stats.bulletBlocked++;
                        updateStats();
                        gameObjects.bullets.splice(index, 1);
                    }
                } else {
                    gameObjects.bullets.splice(index, 1);
                }
            });
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('missileHits').textContent = stats.missileHits;
            document.getElementById('bulletBlocked').textContent = stats.bulletBlocked;
            document.getElementById('obstaclesPenetrated').textContent = stats.obstaclesPenetrated;
            
            const total = stats.missileHits + stats.bulletBlocked + stats.obstaclesPenetrated;
            const penetrationRate = total > 0 ? Math.round((stats.obstaclesPenetrated / total) * 100) : 100;
            document.getElementById('penetrationRate').textContent = penetrationRate + '%';
        }

        // æ¸…ç©ºç”»å¸ƒ
        function clearCanvas() {
            const canvas = document.getElementById('penetrationCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 800, 400);
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            gameObjects.missiles = [];
            gameObjects.bullets = [];
            
            drawScene(ctx);
        }

        // è¿è¡Œç¢°æ’æµ‹è¯•
        function runCollisionTest() {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    if (Math.random() > 0.5) {
                        startPenetrationDemo();
                    } else {
                        startNormalBulletDemo();
                    }
                }, i * 1000);
            }
        }

        // é‡ç½®ç»Ÿè®¡
        function resetStats() {
            stats = {
                missileHits: 0,
                bulletBlocked: 0,
                obstaclesPenetrated: 0
            };
            updateStats();
        }

        // æµ‹è¯•æ‰‹æŸ„è¾“å…¥
        function testGamepadInput() {
            const gamepads = navigator.getGamepads();
            let gamepadFound = false;
            
            for (let i = 0; i < gamepads.length; i++) {
                if (gamepads[i]) {
                    gamepadFound = true;
                    const gamepad = gamepads[i];
                    const status = document.getElementById('gamepadStatus');
                    
                    // æ£€æŸ¥BæŒ‰é’® (æŒ‰é’®1)
                    const bPressed = gamepad.buttons[1] && gamepad.buttons[1].pressed;
                    
                    // æ£€æŸ¥RTæ‰³æœº (è½´5æˆ–æŒ‰é’®7)
                    const rtPressed = (gamepad.axes[5] && gamepad.axes[5] > 0.1) || 
                                     (gamepad.buttons[7] && gamepad.buttons[7].pressed);
                    
                    status.innerHTML = `
                        ğŸ® æ‰‹æŸ„å·²è¿æ¥: ${gamepad.id}<br>
                        ğŸ…±ï¸ BæŒ‰é’®: ${bPressed ? 'âœ… æŒ‰ä¸‹' : 'â­• æœªæŒ‰ä¸‹'}<br>
                        ğŸ¯ RTæ‰³æœº: ${rtPressed ? 'âœ… æŒ‰ä¸‹' : 'â­• æœªæŒ‰ä¸‹'}<br>
                        ğŸš€ å¯¼å¼¹å‘å°„: ${(bPressed || rtPressed) ? 'ğŸ”¥ å¯å‘å°„' : 'â¸ï¸ å¾…å‘½'}
                    `;
                    break;
                }
            }
            
            if (!gamepadFound) {
                document.getElementById('gamepadStatus').innerHTML = 'âŒ æœªæ£€æµ‹åˆ°æ‰‹æŸ„ï¼Œè¯·è¿æ¥Xboxæ§åˆ¶å™¨';
            }
        }

        // æ¨¡æ‹ŸæŒ‰é”®æŒ‰ä¸‹
        function simulateButtonPress(button) {
            const status = document.getElementById('gamepadStatus');
            status.innerHTML = `ğŸ® æ¨¡æ‹ŸæŒ‰é”®: ${button} æŒ‰é’®<br>ğŸš€ å¯¼å¼¹å‘å°„è§¦å‘ï¼`;
            
            setTimeout(() => {
                status.innerHTML = 'ğŸ® æ¨¡æ‹Ÿæµ‹è¯•å®Œæˆ';
            }, 2000);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            clearCanvas();
            updateStats();
            
            // å®šæœŸæ£€æŸ¥æ‰‹æŸ„çŠ¶æ€
            setInterval(testGamepadInput, 1000);
        });
    </script>
</body>
</html>
